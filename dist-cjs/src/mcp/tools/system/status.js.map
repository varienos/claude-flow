{"version":3,"sources":["../../../../../src/mcp/tools/system/status.ts"],"sourcesContent":["/**\n * System Status Tool\n *\n * Returns comprehensive system status including:\n * - Uptime and version information\n * - Active agents and tasks\n * - Memory usage\n * - Performance metrics\n */\n\nimport type { MCPTool, ClaudeFlowToolContext } from '../../types.js';\nimport type { ILogger } from '../../../interfaces/logger.js';\n\ninterface SystemStatusInput {\n  includeMetrics?: boolean;\n  includeAgents?: boolean;\n  includeTasks?: boolean;\n}\n\ninterface SystemStatusResult {\n  success: boolean;\n  status: 'healthy' | 'degraded' | 'unhealthy';\n  uptime: number;\n  version: string;\n  timestamp: string;\n  agents?: {\n    total: number;\n    active: number;\n    idle: number;\n  };\n  tasks?: {\n    total: number;\n    running: number;\n    completed: number;\n    failed: number;\n  };\n  metrics?: {\n    memoryUsage: number;\n    cpuUsage: number;\n    avgResponseTime: number;\n  };\n}\n\nexport function createSystemStatusTool(logger: ILogger): MCPTool {\n  return {\n    name: 'system/status',\n    description: 'Get comprehensive system status including uptime, active agents, tasks, and performance metrics. Use this to check system health.',\n\n    inputSchema: {\n      type: 'object',\n      properties: {\n        includeMetrics: {\n          type: 'boolean',\n          description: 'Include performance metrics',\n          default: false,\n        },\n        includeAgents: {\n          type: 'boolean',\n          description: 'Include agent statistics',\n          default: true,\n        },\n        includeTasks: {\n          type: 'boolean',\n          description: 'Include task statistics',\n          default: true,\n        },\n      },\n      required: [],\n    },\n\n    metadata: {\n      category: 'system',\n      tags: ['status', 'health', 'monitoring', 'metrics'],\n      examples: [\n        {\n          description: 'Get basic system status',\n          input: {},\n          expectedOutput: {\n            success: true,\n            status: 'healthy',\n            uptime: 3600000,\n            version: '2.7.32',\n          },\n        },\n        {\n          description: 'Get full system status with metrics',\n          input: {\n            includeMetrics: true,\n            includeAgents: true,\n            includeTasks: true,\n          },\n          expectedOutput: {\n            success: true,\n            status: 'healthy',\n            agents: { total: 5, active: 3, idle: 2 },\n            tasks: { total: 20, running: 5, completed: 12, failed: 3 },\n            metrics: { memoryUsage: 250, cpuUsage: 45, avgResponseTime: 150 },\n          },\n        },\n      ],\n      detailLevel: 'standard',\n    },\n\n    handler: async (\n      input: any,\n      context?: ClaudeFlowToolContext\n    ): Promise<SystemStatusResult> => {\n      if (!context?.orchestrator) {\n        throw new Error('Orchestrator not available in tool context');\n      }\n\n      const validatedInput = input as SystemStatusInput;\n\n      logger.info('system/status invoked', {\n        input: validatedInput,\n        sessionId: context.sessionId,\n      });\n\n      try {\n        // Get base status\n        const result: SystemStatusResult = {\n          success: true,\n          status: 'healthy',\n          uptime: process.uptime() * 1000, // Convert to milliseconds\n          version: process.env.npm_package_version || '2.7.32',\n          timestamp: new Date().toISOString(),\n        };\n\n        // Get agent statistics if requested\n        if (validatedInput.includeAgents !== false) {\n          try {\n            const agentStats = await context.orchestrator.getAgentStats?.();\n            if (agentStats) {\n              result.agents = {\n                total: agentStats.total || 0,\n                active: agentStats.active || 0,\n                idle: agentStats.idle || 0,\n              };\n            }\n          } catch (error) {\n            logger.warn('Failed to get agent statistics', { error });\n          }\n        }\n\n        // Get task statistics if requested\n        if (validatedInput.includeTasks !== false) {\n          try {\n            const taskStats = await context.orchestrator.getTaskStats?.();\n            if (taskStats) {\n              result.tasks = {\n                total: taskStats.total || 0,\n                running: taskStats.running || 0,\n                completed: taskStats.completed || 0,\n                failed: taskStats.failed || 0,\n              };\n            }\n          } catch (error) {\n            logger.warn('Failed to get task statistics', { error });\n          }\n        }\n\n        // Get performance metrics if requested\n        if (validatedInput.includeMetrics) {\n          try {\n            const memUsage = process.memoryUsage();\n            result.metrics = {\n              memoryUsage: Math.round(memUsage.heapUsed / 1024 / 1024), // MB\n              cpuUsage: Math.round(process.cpuUsage().user / 1000), // Approximate %\n              avgResponseTime: 0, // TODO: Get from metrics store\n            };\n          } catch (error) {\n            logger.warn('Failed to get performance metrics', { error });\n          }\n        }\n\n        // Determine overall health status\n        if (result.agents && result.agents.active === 0 && result.agents.total > 0) {\n          result.status = 'degraded';\n        }\n        if (result.tasks && result.tasks.failed > result.tasks.completed / 2) {\n          result.status = 'unhealthy';\n        }\n\n        logger.info('system/status completed successfully', {\n          status: result.status,\n          uptime: result.uptime,\n        });\n\n        return result;\n      } catch (error) {\n        logger.error('system/status failed', {\n          error,\n          input: validatedInput,\n        });\n        throw error;\n      }\n    },\n  };\n}\n\nexport const toolMetadata = {\n  name: 'system/status',\n  description: 'Get system health status and metrics',\n  category: 'system',\n  detailLevel: 'standard' as const,\n};\n"],"names":["createSystemStatusTool","logger","name","description","inputSchema","type","properties","includeMetrics","default","includeAgents","includeTasks","required","metadata","category","tags","examples","input","expectedOutput","success","status","uptime","version","agents","total","active","idle","tasks","running","completed","failed","metrics","memoryUsage","cpuUsage","avgResponseTime","detailLevel","handler","context","orchestrator","Error","validatedInput","info","sessionId","result","process","env","npm_package_version","timestamp","Date","toISOString","agentStats","getAgentStats","error","warn","taskStats","getTaskStats","memUsage","Math","round","heapUsed","user","toolMetadata"],"mappings":"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"}