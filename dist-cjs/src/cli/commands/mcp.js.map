{"version":3,"sources":["../../../../src/cli/commands/mcp.ts"],"sourcesContent":["/**\n * MCP command for Claude-Flow\n */\n\nimport { Command } from '@cliffy/command';\nimport chalk from 'chalk';\nimport { logger } from '../../core/logger.js';\nimport { configManager } from '../../core/config.js';\nimport { MCPServer, type IMCPServer } from '../../mcp/server.js';\nimport { eventBus } from '../../core/event-bus.js';\nimport {\n  createMCPServer,\n  isMCP2025Available,\n  getServerCapabilities,\n  type ExtendedMCPConfig,\n} from '../../mcp/server-factory.js';\nimport type { MCP2025Server } from '../../mcp/server-mcp-2025.js';\n\nlet mcpServer: IMCPServer | MCP2025Server | null = null;\n\nexport const mcpCommand = new Command()\n  .description('Manage MCP server and tools')\n  .action(() => {\n    console.log(chalk.yellow('Please specify a subcommand:'));\n    console.log('  start   - Start the MCP server');\n    console.log('  stop    - Stop the MCP server');\n    console.log('  status  - Show MCP server status');\n    console.log('  tools   - List available MCP tools');\n    console.log('  config  - Show MCP configuration');\n    console.log('  restart - Restart the MCP server');\n    console.log('  logs    - Show MCP server logs');\n  })\n  .command(\n    'start',\n    new Command()\n      .description('Start the MCP server')\n      .option('-p, --port <port:number>', 'Port for MCP server', { default: 3000 })\n      .option('-h, --host <host:string>', 'Host for MCP server', { default: 'localhost' })\n      .option('--transport <transport:string>', 'Transport type (stdio, http)', {\n        default: 'stdio',\n      })\n      .option('--mcp2025', 'Enable MCP 2025-11 features (version negotiation, async jobs, etc.)', {\n        default: false,\n      })\n      .option('--no-legacy', 'Disable legacy client support', { default: false })\n      .action(async (options: any) => {\n        try {\n          const config = await configManager.load();\n\n          // Check if MCP 2025-11 dependencies are available\n          const mcp2025Available = isMCP2025Available();\n          const enableMCP2025 = options.mcp2025 && mcp2025Available;\n\n          if (options.mcp2025 && !mcp2025Available) {\n            console.log(\n              chalk.yellow(\n                '‚ö†Ô∏è  MCP 2025-11 dependencies not found. Install with: npm install uuid ajv ajv-formats ajv-errors'\n              )\n            );\n            console.log(chalk.yellow('   Falling back to legacy MCP server...'));\n          }\n\n          // Build extended configuration\n          const mcpConfig: ExtendedMCPConfig = {\n            ...config.mcp,\n            port: options.port,\n            host: options.host,\n            transport: options.transport,\n            features: {\n              enableMCP2025,\n              supportLegacyClients: options.legacy !== false,\n              enableVersionNegotiation: enableMCP2025,\n              enableAsyncJobs: enableMCP2025,\n              enableRegistryIntegration: false, // Opt-in via env var\n              enableSchemaValidation: enableMCP2025,\n              enableProgressiveDisclosure: true, // Phase 1 feature (always enabled)\n            },\n            mcp2025: enableMCP2025\n              ? {\n                  async: {\n                    enabled: true,\n                    maxJobs: 100,\n                    jobTTL: 3600000,\n                  },\n                  registry: {\n                    enabled: process.env.MCP_REGISTRY_ENABLED === 'true',\n                    url: process.env.MCP_REGISTRY_URL,\n                    apiKey: process.env.MCP_REGISTRY_API_KEY,\n                  },\n                  validation: {\n                    enabled: true,\n                    strictMode: false,\n                  },\n                }\n              : undefined,\n          };\n\n          // Create server using factory\n          mcpServer = await createMCPServer(mcpConfig, eventBus, logger, {\n            autoDetectFeatures: false, // Use explicit config\n          });\n\n          await mcpServer.start();\n\n          // Get capabilities\n          const capabilities = getServerCapabilities(mcpConfig);\n\n          console.log(chalk.green(`‚úÖ MCP server started on ${options.host}:${options.port}`));\n          console.log(\n            chalk.cyan(`üéØ Mode: ${enableMCP2025 ? 'MCP 2025-11 Enhanced' : 'Legacy Compatible'}`)\n          );\n          console.log(chalk.cyan(`üì° Transport: ${options.transport}`));\n\n          if (capabilities.length > 0) {\n            console.log(chalk.cyan(`‚ú® Capabilities: ${capabilities.join(', ')}`));\n          }\n\n          if (enableMCP2025) {\n            console.log(chalk.green('   ‚Ä¢ Version negotiation (YYYY-MM format)'));\n            console.log(chalk.green('   ‚Ä¢ Async job support (poll/resume)'));\n            console.log(chalk.green('   ‚Ä¢ JSON Schema 1.1 validation'));\n            console.log(chalk.green('   ‚Ä¢ Progressive disclosure (98.7% token reduction)'));\n          }\n\n          if (options.transport === 'http') {\n            console.log(chalk.cyan(`üìö Server URL: http://${options.host}:${options.port}`));\n          }\n        } catch (error) {\n          console.error(chalk.red(`‚ùå Failed to start MCP server: ${(error as Error).message}`));\n          logger.error('MCP server startup failed', { error });\n          process.exit(1);\n        }\n      }),\n  )\n  .command(\n    'stop',\n    new Command().description('Stop the MCP server').action(async () => {\n      try {\n        if (mcpServer) {\n          await mcpServer.stop();\n          mcpServer = null;\n          console.log(chalk.green('‚úÖ MCP server stopped'));\n        } else {\n          console.log(chalk.yellow('‚ö†Ô∏è  MCP server is not running'));\n        }\n      } catch (error) {\n        console.error(chalk.red(`‚ùå Failed to stop MCP server: ${(error as Error).message}`));\n        process.exit(1);\n      }\n    }),\n  )\n  .command(\n    'status',\n    new Command().description('Show MCP server status').action(async () => {\n      try {\n        const config = await configManager.load();\n        const isRunning = mcpServer !== null;\n\n        console.log(chalk.cyan('MCP Server Status:'));\n        console.log(`üåê Status: ${isRunning ? chalk.green('Running') : chalk.red('Stopped')}`);\n\n        if (isRunning) {\n          console.log(`üìç Address: ${config.mcp.host}:${config.mcp.port}`);\n          console.log(\n            `üîê Authentication: ${config.mcp.auth ? chalk.green('Enabled') : chalk.yellow('Disabled')}`,\n          );\n          console.log(`üîß Tools: ${chalk.green('Available')}`);\n          console.log(`üìä Metrics: ${chalk.green('Collecting')}`);\n        } else {\n          console.log(chalk.gray('Use \"claude-flow mcp start\" to start the server'));\n        }\n      } catch (error) {\n        console.error(chalk.red(`‚ùå Failed to get MCP status: ${(error as Error).message}`));\n      }\n    }),\n  )\n  .command(\n    'tools',\n    new Command().description('List available MCP tools').action(() => {\n      console.log(chalk.cyan('Available MCP Tools:'));\n\n      console.log('\\nüìä Research Tools:');\n      console.log('  ‚Ä¢ web_search - Search the web for information');\n      console.log('  ‚Ä¢ web_fetch - Fetch content from URLs');\n      console.log('  ‚Ä¢ knowledge_query - Query knowledge base');\n\n      console.log('\\nüíª Code Tools:');\n      console.log('  ‚Ä¢ code_edit - Edit code files');\n      console.log('  ‚Ä¢ code_search - Search through codebase');\n      console.log('  ‚Ä¢ code_analyze - Analyze code quality');\n\n      console.log('\\nüñ•Ô∏è  Terminal Tools:');\n      console.log('  ‚Ä¢ terminal_execute - Execute shell commands');\n      console.log('  ‚Ä¢ terminal_session - Manage terminal sessions');\n      console.log('  ‚Ä¢ file_operations - File system operations');\n\n      console.log('\\nüíæ Memory Tools:');\n      console.log('  ‚Ä¢ memory_store - Store information');\n      console.log('  ‚Ä¢ memory_query - Query stored information');\n      console.log('  ‚Ä¢ memory_index - Index and search content');\n    }),\n  )\n  .command(\n    'config',\n    new Command().description('Show MCP configuration').action(async () => {\n      try {\n        const config = await configManager.load();\n\n        console.log(chalk.cyan('MCP Configuration:'));\n        console.log(JSON.stringify(config.mcp, null, 2));\n      } catch (error) {\n        console.error(chalk.red(`‚ùå Failed to show MCP config: ${(error as Error).message}`));\n      }\n    }),\n  )\n  .command(\n    'restart',\n    new Command().description('Restart the MCP server').action(async () => {\n      try {\n        console.log(chalk.yellow('üîÑ Stopping MCP server...'));\n        if (mcpServer) {\n          await mcpServer.stop();\n        }\n\n        console.log(chalk.yellow('üîÑ Starting MCP server...'));\n        const config = await configManager.load();\n\n        // Use factory to create server with same capabilities as before\n        mcpServer = await createMCPServer(config.mcp, eventBus, logger, {\n          autoDetectFeatures: true, // Auto-detect on restart\n        });\n        await mcpServer.start();\n\n        console.log(\n          chalk.green(`‚úÖ MCP server restarted on ${config.mcp.host}:${config.mcp.port}`),\n        );\n      } catch (error) {\n        console.error(chalk.red(`‚ùå Failed to restart MCP server: ${(error as Error).message}`));\n        process.exit(1);\n      }\n    }),\n  )\n  .command(\n    'logs',\n    new Command()\n      .description('Show MCP server logs')\n      .option('-n, --lines <lines:number>', 'Number of log lines to show', { default: 50 })\n      .action((options: any) => {\n        console.log(chalk.cyan(`MCP Server Logs (last ${options.lines} lines):`));\n\n        // Mock logs since logging system might not be fully implemented\n        const logEntries = [\n          '2024-01-10 10:00:00 [INFO] MCP server started on localhost:3000',\n          '2024-01-10 10:00:01 [INFO] Tools registered: 12',\n          '2024-01-10 10:00:02 [INFO] Authentication disabled',\n          '2024-01-10 10:01:00 [INFO] Client connected: claude-desktop',\n          '2024-01-10 10:01:05 [INFO] Tool called: web_search',\n          '2024-01-10 10:01:10 [INFO] Tool response sent successfully',\n          '2024-01-10 10:02:00 [INFO] Tool called: terminal_execute',\n          '2024-01-10 10:02:05 [INFO] Command executed successfully',\n          '2024-01-10 10:03:00 [INFO] Memory operation: store',\n          '2024-01-10 10:03:01 [INFO] Data stored in namespace: default',\n        ];\n\n        const startIndex = Math.max(0, logEntries.length - options.lines);\n        const displayLogs = logEntries.slice(startIndex);\n\n        for (const entry of displayLogs) {\n          if (entry.includes('[ERROR]')) {\n            console.log(chalk.red(entry));\n          } else if (entry.includes('[WARN]')) {\n            console.log(chalk.yellow(entry));\n          } else if (entry.includes('[INFO]')) {\n            console.log(chalk.green(entry));\n          } else {\n            console.log(chalk.gray(entry));\n          }\n        }\n      }),\n  );\n"],"names":["Command","chalk","logger","configManager","eventBus","createMCPServer","isMCP2025Available","getServerCapabilities","mcpServer","mcpCommand","description","action","console","log","yellow","command","option","default","options","config","load","mcp2025Available","enableMCP2025","mcp2025","mcpConfig","mcp","port","host","transport","features","supportLegacyClients","legacy","enableVersionNegotiation","enableAsyncJobs","enableRegistryIntegration","enableSchemaValidation","enableProgressiveDisclosure","async","enabled","maxJobs","jobTTL","registry","process","env","MCP_REGISTRY_ENABLED","url","MCP_REGISTRY_URL","apiKey","MCP_REGISTRY_API_KEY","validation","strictMode","undefined","autoDetectFeatures","start","capabilities","green","cyan","length","join","error","red","message","exit","stop","isRunning","auth","gray","JSON","stringify","lines","logEntries","startIndex","Math","max","displayLogs","slice","entry","includes"],"mappings":"AAIA,SAASA,OAAO,QAAQ,kBAAkB;AAC1C,OAAOC,WAAW,QAAQ;AAC1B,SAASC,MAAM,QAAQ,uBAAuB;AAC9C,SAASC,aAAa,QAAQ,uBAAuB;AAErD,SAASC,QAAQ,QAAQ,0BAA0B;AACnD,SACEC,eAAe,EACfC,kBAAkB,EAClBC,qBAAqB,QAEhB,8BAA8B;AAGrC,IAAIC,YAA+C;AAEnD,OAAO,MAAMC,aAAa,IAAIT,UAC3BU,WAAW,CAAC,+BACZC,MAAM,CAAC;IACNC,QAAQC,GAAG,CAACZ,MAAMa,MAAM,CAAC;IACzBF,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;AACd,GACCE,OAAO,CACN,SACA,IAAIf,UACDU,WAAW,CAAC,wBACZM,MAAM,CAAC,4BAA4B,uBAAuB;IAAEC,SAAS;AAAK,GAC1ED,MAAM,CAAC,4BAA4B,uBAAuB;IAAEC,SAAS;AAAY,GACjFD,MAAM,CAAC,kCAAkC,gCAAgC;IACxEC,SAAS;AACX,GACCD,MAAM,CAAC,aAAa,uEAAuE;IAC1FC,SAAS;AACX,GACCD,MAAM,CAAC,eAAe,iCAAiC;IAAEC,SAAS;AAAM,GACxEN,MAAM,CAAC,OAAOO;IACb,IAAI;QACF,MAAMC,SAAS,MAAMhB,cAAciB,IAAI;QAGvC,MAAMC,mBAAmBf;QACzB,MAAMgB,gBAAgBJ,QAAQK,OAAO,IAAIF;QAEzC,IAAIH,QAAQK,OAAO,IAAI,CAACF,kBAAkB;YACxCT,QAAQC,GAAG,CACTZ,MAAMa,MAAM,CACV;YAGJF,QAAQC,GAAG,CAACZ,MAAMa,MAAM,CAAC;QAC3B;QAGA,MAAMU,YAA+B;YACnC,GAAGL,OAAOM,GAAG;YACbC,MAAMR,QAAQQ,IAAI;YAClBC,MAAMT,QAAQS,IAAI;YAClBC,WAAWV,QAAQU,SAAS;YAC5BC,UAAU;gBACRP;gBACAQ,sBAAsBZ,QAAQa,MAAM,KAAK;gBACzCC,0BAA0BV;gBAC1BW,iBAAiBX;gBACjBY,2BAA2B;gBAC3BC,wBAAwBb;gBACxBc,6BAA6B;YAC/B;YACAb,SAASD,gBACL;gBACEe,OAAO;oBACLC,SAAS;oBACTC,SAAS;oBACTC,QAAQ;gBACV;gBACAC,UAAU;oBACRH,SAASI,QAAQC,GAAG,CAACC,oBAAoB,KAAK;oBAC9CC,KAAKH,QAAQC,GAAG,CAACG,gBAAgB;oBACjCC,QAAQL,QAAQC,GAAG,CAACK,oBAAoB;gBAC1C;gBACAC,YAAY;oBACVX,SAAS;oBACTY,YAAY;gBACd;YACF,IACAC;QACN;QAGA3C,YAAY,MAAMH,gBAAgBmB,WAAWpB,UAAUF,QAAQ;YAC7DkD,oBAAoB;QACtB;QAEA,MAAM5C,UAAU6C,KAAK;QAGrB,MAAMC,eAAe/C,sBAAsBiB;QAE3CZ,QAAQC,GAAG,CAACZ,MAAMsD,KAAK,CAAC,CAAC,wBAAwB,EAAErC,QAAQS,IAAI,CAAC,CAAC,EAAET,QAAQQ,IAAI,EAAE;QACjFd,QAAQC,GAAG,CACTZ,MAAMuD,IAAI,CAAC,CAAC,SAAS,EAAElC,gBAAgB,yBAAyB,qBAAqB;QAEvFV,QAAQC,GAAG,CAACZ,MAAMuD,IAAI,CAAC,CAAC,cAAc,EAAEtC,QAAQU,SAAS,EAAE;QAE3D,IAAI0B,aAAaG,MAAM,GAAG,GAAG;YAC3B7C,QAAQC,GAAG,CAACZ,MAAMuD,IAAI,CAAC,CAAC,gBAAgB,EAAEF,aAAaI,IAAI,CAAC,OAAO;QACrE;QAEA,IAAIpC,eAAe;YACjBV,QAAQC,GAAG,CAACZ,MAAMsD,KAAK,CAAC;YACxB3C,QAAQC,GAAG,CAACZ,MAAMsD,KAAK,CAAC;YACxB3C,QAAQC,GAAG,CAACZ,MAAMsD,KAAK,CAAC;YACxB3C,QAAQC,GAAG,CAACZ,MAAMsD,KAAK,CAAC;QAC1B;QAEA,IAAIrC,QAAQU,SAAS,KAAK,QAAQ;YAChChB,QAAQC,GAAG,CAACZ,MAAMuD,IAAI,CAAC,CAAC,sBAAsB,EAAEtC,QAAQS,IAAI,CAAC,CAAC,EAAET,QAAQQ,IAAI,EAAE;QAChF;IACF,EAAE,OAAOiC,OAAO;QACd/C,QAAQ+C,KAAK,CAAC1D,MAAM2D,GAAG,CAAC,CAAC,8BAA8B,EAAE,AAACD,MAAgBE,OAAO,EAAE;QACnF3D,OAAOyD,KAAK,CAAC,6BAA6B;YAAEA;QAAM;QAClDjB,QAAQoB,IAAI,CAAC;IACf;AACF,IAEH/C,OAAO,CACN,QACA,IAAIf,UAAUU,WAAW,CAAC,uBAAuBC,MAAM,CAAC;IACtD,IAAI;QACF,IAAIH,WAAW;YACb,MAAMA,UAAUuD,IAAI;YACpBvD,YAAY;YACZI,QAAQC,GAAG,CAACZ,MAAMsD,KAAK,CAAC;QAC1B,OAAO;YACL3C,QAAQC,GAAG,CAACZ,MAAMa,MAAM,CAAC;QAC3B;IACF,EAAE,OAAO6C,OAAO;QACd/C,QAAQ+C,KAAK,CAAC1D,MAAM2D,GAAG,CAAC,CAAC,6BAA6B,EAAE,AAACD,MAAgBE,OAAO,EAAE;QAClFnB,QAAQoB,IAAI,CAAC;IACf;AACF,IAED/C,OAAO,CACN,UACA,IAAIf,UAAUU,WAAW,CAAC,0BAA0BC,MAAM,CAAC;IACzD,IAAI;QACF,MAAMQ,SAAS,MAAMhB,cAAciB,IAAI;QACvC,MAAM4C,YAAYxD,cAAc;QAEhCI,QAAQC,GAAG,CAACZ,MAAMuD,IAAI,CAAC;QACvB5C,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAEmD,YAAY/D,MAAMsD,KAAK,CAAC,aAAatD,MAAM2D,GAAG,CAAC,YAAY;QAErF,IAAII,WAAW;YACbpD,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEM,OAAOM,GAAG,CAACE,IAAI,CAAC,CAAC,EAAER,OAAOM,GAAG,CAACC,IAAI,EAAE;YAC/Dd,QAAQC,GAAG,CACT,CAAC,mBAAmB,EAAEM,OAAOM,GAAG,CAACwC,IAAI,GAAGhE,MAAMsD,KAAK,CAAC,aAAatD,MAAMa,MAAM,CAAC,aAAa;YAE7FF,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEZ,MAAMsD,KAAK,CAAC,cAAc;YACnD3C,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEZ,MAAMsD,KAAK,CAAC,eAAe;QACxD,OAAO;YACL3C,QAAQC,GAAG,CAACZ,MAAMiE,IAAI,CAAC;QACzB;IACF,EAAE,OAAOP,OAAO;QACd/C,QAAQ+C,KAAK,CAAC1D,MAAM2D,GAAG,CAAC,CAAC,4BAA4B,EAAE,AAACD,MAAgBE,OAAO,EAAE;IACnF;AACF,IAED9C,OAAO,CACN,SACA,IAAIf,UAAUU,WAAW,CAAC,4BAA4BC,MAAM,CAAC;IAC3DC,QAAQC,GAAG,CAACZ,MAAMuD,IAAI,CAAC;IAEvB5C,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IAEZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IAEZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IAEZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;AACd,IAEDE,OAAO,CACN,UACA,IAAIf,UAAUU,WAAW,CAAC,0BAA0BC,MAAM,CAAC;IACzD,IAAI;QACF,MAAMQ,SAAS,MAAMhB,cAAciB,IAAI;QAEvCR,QAAQC,GAAG,CAACZ,MAAMuD,IAAI,CAAC;QACvB5C,QAAQC,GAAG,CAACsD,KAAKC,SAAS,CAACjD,OAAOM,GAAG,EAAE,MAAM;IAC/C,EAAE,OAAOkC,OAAO;QACd/C,QAAQ+C,KAAK,CAAC1D,MAAM2D,GAAG,CAAC,CAAC,6BAA6B,EAAE,AAACD,MAAgBE,OAAO,EAAE;IACpF;AACF,IAED9C,OAAO,CACN,WACA,IAAIf,UAAUU,WAAW,CAAC,0BAA0BC,MAAM,CAAC;IACzD,IAAI;QACFC,QAAQC,GAAG,CAACZ,MAAMa,MAAM,CAAC;QACzB,IAAIN,WAAW;YACb,MAAMA,UAAUuD,IAAI;QACtB;QAEAnD,QAAQC,GAAG,CAACZ,MAAMa,MAAM,CAAC;QACzB,MAAMK,SAAS,MAAMhB,cAAciB,IAAI;QAGvCZ,YAAY,MAAMH,gBAAgBc,OAAOM,GAAG,EAAErB,UAAUF,QAAQ;YAC9DkD,oBAAoB;QACtB;QACA,MAAM5C,UAAU6C,KAAK;QAErBzC,QAAQC,GAAG,CACTZ,MAAMsD,KAAK,CAAC,CAAC,0BAA0B,EAAEpC,OAAOM,GAAG,CAACE,IAAI,CAAC,CAAC,EAAER,OAAOM,GAAG,CAACC,IAAI,EAAE;IAEjF,EAAE,OAAOiC,OAAO;QACd/C,QAAQ+C,KAAK,CAAC1D,MAAM2D,GAAG,CAAC,CAAC,gCAAgC,EAAE,AAACD,MAAgBE,OAAO,EAAE;QACrFnB,QAAQoB,IAAI,CAAC;IACf;AACF,IAED/C,OAAO,CACN,QACA,IAAIf,UACDU,WAAW,CAAC,wBACZM,MAAM,CAAC,8BAA8B,+BAA+B;IAAEC,SAAS;AAAG,GAClFN,MAAM,CAAC,CAACO;IACPN,QAAQC,GAAG,CAACZ,MAAMuD,IAAI,CAAC,CAAC,sBAAsB,EAAEtC,QAAQmD,KAAK,CAAC,QAAQ,CAAC;IAGvE,MAAMC,aAAa;QACjB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,MAAMC,aAAaC,KAAKC,GAAG,CAAC,GAAGH,WAAWb,MAAM,GAAGvC,QAAQmD,KAAK;IAChE,MAAMK,cAAcJ,WAAWK,KAAK,CAACJ;IAErC,KAAK,MAAMK,SAASF,YAAa;QAC/B,IAAIE,MAAMC,QAAQ,CAAC,YAAY;YAC7BjE,QAAQC,GAAG,CAACZ,MAAM2D,GAAG,CAACgB;QACxB,OAAO,IAAIA,MAAMC,QAAQ,CAAC,WAAW;YACnCjE,QAAQC,GAAG,CAACZ,MAAMa,MAAM,CAAC8D;QAC3B,OAAO,IAAIA,MAAMC,QAAQ,CAAC,WAAW;YACnCjE,QAAQC,GAAG,CAACZ,MAAMsD,KAAK,CAACqB;QAC1B,OAAO;YACLhE,QAAQC,GAAG,CAACZ,MAAMiE,IAAI,CAACU;QACzB;IACF;AACF,IACF"}